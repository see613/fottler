# api



* [api](#api)
  * [События](#%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F)
    - [Получить все события.](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F)
    - [Получить одно событие.](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%BE%D0%B4%D0%BD%D0%BE-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5)
    - [Получить все события в избранном.](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F-%D0%B2-%D0%B8%D0%B7%D0%B1%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%BC)
    - [Получить мои события. (в которых я участвую, а также которые создал)](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%BC%D0%BE%D0%B8-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F-%D0%B2-%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D1%85-%D1%8F-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%B2%D1%83%D1%8E-%D0%B0-%D1%82%D0%B0%D0%BA%D0%B6%D0%B5-%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BB)
    - [Подать заявку на участие в событии](#%D0%BF%D0%BE%D0%B4%D0%B0%D1%82%D1%8C-%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D1%83-%D0%BD%D0%B0-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%B8%D0%B5-%D0%B2-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8)
    - [Создать событие](#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5)
    - [Загрузить изображение при создании события](#%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%B8-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B8-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F)
    - [Добавить событие в избранное](#%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5-%D0%B2-%D0%B8%D0%B7%D0%B1%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5)
    - [Убрать событие из избранного](#%D1%83%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5-%D0%B8%D0%B7-%D0%B8%D0%B7%D0%B1%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE)
    - [Одобрить запрос юзера на участие в моём событии](#%D0%BE%D0%B4%D0%BE%D0%B1%D1%80%D0%B8%D1%82%D1%8C-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0-%D0%BD%D0%B0-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%B8%D0%B5-%D0%B2-%D0%BC%D0%BE%D1%91%D0%BC-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8)
    - [Отклонить запрос юзера на участие в моём событии](#%D0%BE%D1%82%D0%BA%D0%BB%D0%BE%D0%BD%D0%B8%D1%82%D1%8C-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0-%D0%BD%D0%B0-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%B8%D0%B5-%D0%B2-%D0%BC%D0%BE%D1%91%D0%BC-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8)
  * [Юзер](#%D1%8E%D0%B7%D0%B5%D1%80)
    - [Получить всех юзеров](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5%D1%85-%D1%8E%D0%B7%D0%B5%D1%80%D0%BE%D0%B2)
    - [Получить одного юзера](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%BE%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0)
    - [Получить всех юзеров, участвующих в событии, включая создателя](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5%D1%85-%D1%8E%D0%B7%D0%B5%D1%80%D0%BE%D0%B2-%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%B2%D1%83%D1%8E%D1%89%D0%B8%D1%85-%D0%B2-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8)
    - [Получить юзера приложения](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F)
    - [Редактировать юзера](#%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0)
    - [Загрузить аватар при редактировании юзера](#%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C-%D0%B0%D0%B2%D0%B0%D1%82%D0%B0%D1%80-%D0%BF%D1%80%D0%B8-%D1%80%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8-%D1%8E%D0%B7%D0%B5%D1%80%D0%B0)
    - [Получить sms код для аутентификации (вход/регистрация)](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-sms-%D0%BA%D0%BE%D0%B4-%D0%B4%D0%BB%D1%8F-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8-%D0%B2%D1%85%D0%BE%D0%B4%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F)
    - [Получить токен для аутентификации (вход/регистрация)](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%82%D0%BE%D0%BA%D0%B5%D0%BD-%D0%B4%D0%BB%D1%8F-%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8-%D0%B2%D1%85%D0%BE%D0%B4%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F)
    - [Изменить статус моего друга](#%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C-%D1%81%D1%82%D0%B0%D1%82%D1%83%D1%81-%D0%BC%D0%BE%D0%B5%D0%B3%D0%BE-%D0%B4%D1%80%D1%83%D0%B3%D0%B0)
  * [Категория события](#%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D1%8F-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F)
    - [Получить все категории](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5-%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B8)
    - [Добавить категорию](#%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D1%8E)
  * [Запросы в тех.поддержку](#%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%8B-%D0%B2-%D1%82%D0%B5%D1%85%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D1%83)
    - [Добавить запрос в тех.поддержку](#%D0%B4%D0%BE%D0%B1%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81-%D0%B2-%D1%82%D0%B5%D1%85%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D1%83)
  * [Чат](#%D1%87%D0%B0%D1%82)
    - [Отправить сообщение](#%D0%BE%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5)
    - [Получить сообщения старее определённого сообщения](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-%D1%81%D1%82%D0%B0%D1%80%D0%B5%D0%B5-%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
    - [Получить сообщения новее определённого сообщения](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%BE%D0%B2%D0%B5%D0%B5-%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
  * [Оповещения](#%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
    - [Получить все оповещения](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5-%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
  * [Сообщения](#%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
    - [Получить все сообщения на странице Сообщения](#%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D0%B2%D1%81%D0%B5-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B5-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)



## События

### Получить все события.
```
GET /api/event/getAll
```
Параметры: см. Parameters для получения всех событий

Ответ:
```js
{
    "status": "success",
    "events": [
        массив объектов <Событие>
    ]
}
```

### Получить одно событие.
```
GET /api/event/getOne
```
Параметры:
```js
        id: 1 // id события
```
Ответ:
```js
{
    "status": "success",
    "event": объект <Событие>
}
```

### Получить все события в избранном.
```
GET /api/event/getFavorite
```
Параметры: см. Parameters для получения всех событий

Ответ:
```js
{
    "status": "success",
    "events": [
        массив объектов <Событие>
    ]
}
```

### Получить мои события. (в которых я участвую, а также которые создал)
```
GET /api/event/getMyEvents
```
Параметры: см. Parameters для получения всех событий

Ответ:
```js
{
    "status": "success",
    "events": [
        массив объектов <Событие>
    ]
}
```

### Подать заявку на участие в событии
```
POST /api/event/apply
```
Параметры: 
```js
    event_id: 1 // id события
```
Ответ:
```js
{
    "status": "success",
    "event": объект <Событие>
}
```

### Создать событие
```
POST /api/event/add
```
Параметры: 
```js
    // все параметры описаны в entities событие
    title: "название события",
    about: "о событии",
    datetime: "2012-12-02 22:13",
    address: "полный адрес события",
    lat: 0,
    lng: 0,
    category: [1,2,3],
    food_preferences: [1,2,3],
    drink_preferences: [1,2,3],
    max_males_number: 1,
    max_females_number: 1,
    picture: "picture.png"
```
Ответ:
```js
{
    "status": "success",
    "event": объект <Событие>
}
```

### Загрузить изображение при создании события
```
POST /api/event/uploadPicture
```
Параметры: 
```js
    file: (binary) // бинарный файл как при отправке multipart формы. Форматы: jpeg,jpg,png,gif,webp. Макс.размер: 10Mb
```
Ответ:
```js
{
    "status": "success",
    "fileName": "имя загруженного файла с расширением, а не полный путь"
}
```

### Добавить событие в избранное
```
POST /api/event/addToFavorites
```
Параметры: 
```js
    event_id: 1 // id события
```
Ответ:
```js
{
    "status": "success",
    "event": объект <Событие>
}
```

### Убрать событие из избранного
```
POST /api/event/removeFromFavorites
```
Параметры: 
```js
    event_id: 1 // id события
```
Ответ:
```js
{
    "status": "success",
    "event": объект <Событие>
}
```

### Одобрить запрос юзера на участие в моём событии
```
POST /api/event/acceptRequest
```
Параметры: 
```js
    event_id: 1, // id события
    user_id: 1 // id юзера
```
Ответ:
```js
{
    "status": "success"
}
```

### Отклонить запрос юзера на участие в моём событии
```
POST /api/event/rejectRequest
```
Параметры: 
```js
    event_id: 1, // id события
    user_id: 1 // id юзера
```
Ответ:
```js
{
    "status": "success"
}
```

## Юзер

### Получить всех юзеров
```
GET /api/user/getAll
```
Параметры: 
```js
    status: 1, // 0 - мы не друзья, 1 - отправил мне запрос на дружбу, 2 - я отправил ему запрос, 3 - мы друзья
    text: "поисковый запрос",
    food_preferences: [1,2,3] // см. enities юзер
    drink_preferences: [1,2,3] // см. enities юзер
    gender: 1 // см. enities юзер
```
Ответ:
```js
{
    "status": "success",
    "users": [
        массив объектов <Юзер>
    ],
    // возвращать, если параметр status="3"
    "request_amount": 1 // кол-во запросов ко мне в друзья
}
```

### Получить одного юзера
```
GET /api/user/getOne
```
Параметры: 
```js
    id: 1 // id юзера
```
Ответ:
```js
{
    "status": "success",
    "user": объект <Юзер>
}
```

### Получить всех юзеров, участвующих в событии, включая создателя
```
GET /api/user/getByEvent
```
Параметры: 
```js
    event_id: 1 // id события
```
Ответ:
```js
{
    "status": "success",
    "users": [
        массив объектов <Юзер>
    ]
}
```

### Получить юзера приложения
```
GET /api/user/getInfo
```
Параметры: отсутствуют
Ответ:
```js
{
    "status": "success",
    "user": объект <Юзер>
}
```

### Редактировать юзера
```
POST /api/user/edit
```
Параметры: 
```js
    // все параметры описаны в entities юзер
    name: "имя юзера"
    birthday: "2012-12-02",
    gender: 1
    geolocation: true
    food_preferences: [1,2,3]
    drink_preferences: [1,2,3]
    about: "текст о юзере"
    is_subscribed: true
    avatar: "picture.jpg"
    city: "Москва"
```
Ответ:
```js
{
    "status": "success",
    "user": объект <Юзер>
}
```

### Загрузить аватар при редактировании юзера
```
POST /api/user/uploadPicture
```
Параметры: 
```js
    file: (binary) // бинарный файл как при отправке multipart формы. Форматы: jpeg,jpg,png,gif,webp. Макс.размер: 10Mb
```
Ответ:
```js
{
    "status": "success",
    "fileName": "имя загруженного файла с расширением, а не полный путь"
}
```

### Получить sms код для аутентификации (вход/регистрация) 
```
POST /api/user/login1
```
Параметры:
```js
    phone: 9998887766 // номер телефона (без +7)
```
Ответ:
```js
{
    "status": "success",
    "code": 1234 // 4-значный sms код
}
```

### Получить токен для аутентификации (вход/регистрация) 
```
POST /api/user/login2
```
Параметры:
```js
    phone: 9998887766, // номер телефона (без +7)
    verifyCode: 1234, // 4-значный sms код
```
Ответ:
```js
{
    "status": "success",
    "access_token": "...",
    "refresh_token": "...",
    "user": объект <Юзер> // юзер приложения
}
```

### Изменить статус моего друга
```
POST /api/user/changeFriendStatus
```
Параметры:
```js
    user_id: 1, // id юзера/друга
    status: 1 // 0 - мы не друзья, 2 - я отправил ему запрос на дружбу, 3 - мы друзья
```
Ответ:
```js
{
    "status": "success",
    "user": объект <Юзер> // юзер/друг
}
```

## Категория события

### Получить все категории
```
GET /api/event/category/getAll
```
Параметры: отсутствуют
Ответ:
```js
{
    "status": "success",
    "categories": [
        массив объектов <Категория>
    ]
}
```

### Добавить категорию
```
POST /api/event/category/add
```
Параметры: 
```js
    title: "название категории"
```
Ответ:
```js
{
    "status": "success",
    "category": объект <Категория>
}
```

## Запросы в тех.поддержку

### Добавить запрос в тех.поддержку
```
POST /api/feedback/add
```
Параметры: 
```js
    text: "текст обращения"
```
Ответ:
```js
{
    "status": "success"
}
```

## Чат

### Отправить сообщение
```
POST /api/message/add
```
Параметры: 
```js
    type: 1, // тип сообщения: 1 - сообщение в общем чате события, 2 - личное сообщение
    entity_id: 1, // id события/юзера. Зависит от type
    text: "текст сообщения"
```
Ответ:
```js
{
    "status": "success"
}
```

### Получить сообщения старее определённого сообщения
```
GET /api/message/getOlder
```
Параметры: 
```js
    type: 1, // тип сообщения: 1 - сообщение в общем чате события, 2 - личное сообщение
    entity_id: 1, // id события/юзера. Зависит от type
    message_id: 1 // получаем сообщения, предшествующие этому
```
Ответ:
```js
{
    "status": "success",
    "messages": [
        массив объектов <Сообщение>
    ]
}
```

### Получить сообщения новее определённого сообщения
```
GET /api/message/getNewer
```
Параметры: 
```js
    type: 1, // тип сообщения: 1 - сообщение в общем чате события, 2 - личное сообщение
    entity_id: 1, // id события/юзера. Зависит от type
    message_id: 1 // получаем сообщения, отправленные после этого сообщения
```
Ответ:
```js
{
    "status": "success",
    "messages": [
        массив объектов <Сообщение>
    ]
}
```

## Оповещения

### Получить все оповещения
```
GET /api/notification/getAll
```
Параметры: 
```js
    type: "all", // all - все, unread - непрочитанные, 
                 // events - связанные с событиями (вернуть оповещения с notification.type = 1 или 2)
                 // users - связанные с юзерами (вернуть оповещения с notification.type = 4 или 5)
```
Ответ:
```js
{
    "status": "success",
    "notifications": [
        массив объектов <Оповещение>
    ]
}
```

## Сообщения

### Получить все сообщения на странице Сообщения
```
GET /api/message/myMessages/getAll
```
Параметры: 
```js
    type: "all", // all - все, unread - непрочитанные 
```
Ответ:
```js
{
    "status": "success",
    "messages": [
        массив объектов <Сообщение на странице "Сообщения">
    ]
}
```


for generating ToC: https://github.com/isaacs/github/issues/215#issuecomment-456598835
